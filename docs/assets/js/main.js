"use strict";const fr=new FileReader,uploadBtn=document.querySelector(".js__profile-trigger"),fileField=document.querySelector(".js__profile-upload-btn"),profileImage=document.querySelector(".js__profile-image"),profilePreview=document.querySelector(".js__profile-preview");function getImage(e){const t=e.currentTarget.files[0];fr.addEventListener("load",writeImage),fr.readAsDataURL(t)}function writeImage(){profileImage.style.backgroundImage=`url(${fr.result})`,profilePreview.style.backgroundImage=`url(${fr.result})`,data.photo=fr.result,setToLocalStorage()}function fakeFileClick(){fileField.click()}uploadBtn.addEventListener("click",fakeFileClick),fileField.addEventListener("change",getImage);const arrowEls=document.querySelectorAll(".js-collapsable-title"),clickArrow=function(e){const t=e.currentTarget;if(t.classList.contains("design__title")){const e=document.querySelector(".design__form");t.querySelector(".fa-chevron-up").classList.toggle("js-fa-chevron-up"),e.classList.toggle("js-design__form")}if(t.classList.contains("fill__title")){const e=document.querySelector(".fill__form");t.querySelector(".fa-chevron-up").classList.toggle("js-fa-chevron-up"),e.classList.toggle("js-fill__form")}if(t.classList.contains("share__title")){const e=document.querySelector(".share__section"),r=document.querySelector(".share");t.querySelector(".fa-chevron-up").classList.toggle("js-fa-chevron-up"),e.classList.toggle("js-share__section"),r.classList.toggle("js-share")}};for(const e of arrowEls)e.addEventListener("click",clickArrow);const form=document.querySelectorAll(".js__form"),previewName=document.querySelector(".js__preview-name"),previewJob=document.querySelector(".js__preview-job"),previewPhone=document.querySelector(".js__preview-phone"),previewMail=document.querySelector(".js__preview-mail"),previewLinkedin=document.querySelector(".js__preview-linkedin"),previewGithub=document.querySelector(".js__preview-github"),resetButton=document.querySelector(".js__btn-reset"),profileReset=document.querySelector(".js__profile-image"),previewReset=document.querySelector(".js__profile-preview"),previewElement=document.querySelector(".js-preview__card"),inputElementCold=document.querySelector(".js-inputCold"),inputElementWarm=document.querySelector(".js-inputWarm"),inputElementMedium=document.querySelector(".js-inputMedium"),btn=document.querySelector(".js__btn");let data={palette:"",name:"",job:"",phone:"",email:"",linkedin:"",github:"",photo:""};function getInfoToStorage(){let e=localStorage.getItem("userData");e=JSON.parse(e),null!==e&&(form[0].value=e.name,form[1].value=e.job,form[2].value=e.email,form[3].value=e.phone,form[4].value=e.linkedin,form[5].value=e.github,data=e,1===data.palette?(changeCold(),inputElementCold.click()):2===data.palette?(changeWarm(),inputElementWarm.click()):3===data.palette&&(changeMedium(),inputElementMedium.click()),""!==data.photo?(profileReset.style.backgroundImage=`url(${data.photo})`,previewReset.style.backgroundImage=`url(${data.photo})`):(profileReset.style.backgroundImage="url('./assets/images/totoro.jpg')",previewReset.style.backgroundImage="url('./assets/images/totoro.jpg')"),fillpreview(),getErrors())}function setToLocalStorage(){const e=JSON.stringify(data);localStorage.setItem("userData",e)}function saveField(e){const t=e.currentTarget.name;data[t]=e.currentTarget.value,setToLocalStorage(),fillpreview()}function fillpreview(){previewName.innerHTML=data.name||"Nombre Apellido",previewJob.innerHTML=data.job||"Front-end developer";const e="mailto:"+data.email;previewMail.setAttribute("href",e);const t="tel:"+data.phone;previewPhone.setAttribute("href",t);const r="https://www.linkedin.com/in/"+data.linkedin;previewLinkedin.setAttribute("href",r);const a="https://github.com/"+data.github;previewGithub.setAttribute("href",a)}for(let e=0;e<form.length;e++)form[e].addEventListener("keyup",saveField);for(let e=0;e<form.length;e++)form[e].addEventListener("blur",getErrors);function validarEmail(e){return!!/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}function validarTelf(e){return!!/^[9|6]{1}([\d]{2}[-]*){3}[\d]{2}$/.test(e)}function getErrors(){let e="";if(data.name||(e+="Tienes que rellenar tu nombre. "),data.job||(e+="Tienes que rellenar tu puesto de trabajo. "),data.email?!1===validarEmail(data.email)&&(e+=data.email+" no es un email correcto. "):e+="Tienes que rellenar tu email. ",data.phone?!1===validarTelf(data.phone)&&(e+=data.phone+" no es un número de teléfono correcto. "):e+="Tienes que rellenar tu teléfono. ",data.linkedin||(e+="Tienes que rellenar tu Linkedin. "),data.github||(e+="Tienes que rellenar tu Github. "),""===e){btn.classList.add("js-button-create"),btn.removeAttribute("disabled");const e=document.querySelector(".share__section").querySelector(".paragraph");null!==e&&e.remove()}else{if(btn.classList.remove("js-button-create"),document.querySelector(".paragraph")){document.querySelector(".share__section").querySelector(".paragraph").remove()}const t=document.createElement("p"),r=document.createTextNode(e);t.appendChild(r),t.style="color:red; font-size:10px; margin:10px",t.classList.add("paragraph"),document.querySelector(".share__section").insertBefore(t,btn)}}function reset(){data.palette="",data.name="",data.job="",data.phone="",data.email="",data.linkedin="",data.github="",data.photo="url('./assets/images/totoro.jpg')";for(let e=0;e<form.length;e++)form[e].value="";localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),localStorage.removeItem("userData"),inputElementCold.click(),fillpreview(),profileReset.style.backgroundImage="url('./assets/images/totoro.jpg')",previewReset.style.backgroundImage="",setToLocalStorage()}function changeCold(){previewElement.classList.remove("js-paletteWarm"),previewElement.classList.remove("js-paletteMedium"),previewElement.classList.add("js-paletteCold"),data.palette=1,setToLocalStorage()}function changeWarm(){previewElement.classList.remove("js-paletteCold"),previewElement.classList.remove("js-paletteMedium"),previewElement.classList.add("js-paletteWarm"),data.palette=2,setToLocalStorage()}function changeMedium(){previewElement.classList.remove("js-paletteCold"),previewElement.classList.remove("js-paletteWarm"),previewElement.classList.add("js-paletteMedium"),data.palette=3,setToLocalStorage()}resetButton.addEventListener("click",reset),getInfoToStorage(),inputElementCold.addEventListener("click",changeCold),inputElementWarm.addEventListener("click",changeWarm),inputElementMedium.addEventListener("click",changeMedium);const shareFinish=document.querySelector(".js__share__finish");function finishClick(){btn.classList.remove("js-button-create"),shareFinish.classList.remove("js__finish-hidden"),sendRequest()}function sendRequest(){fetch("https://us-central1-awesome-cards-cf6f0.cloudfunctions.net/card/",{method:"POST",body:JSON.stringify(data),headers:{"content-type":"application/json"}}).then((function(e){return e.json()})).then((function(e){showURL(e)}))}function showURL(e){const t=document.querySelector(".share__finish--text");!0===e.success?t.innerHTML="<a href="+e.cardURL+' target="_blank" class="card-link js-card-link2">'+e.cardURL+"</a>":t.innerHTML="ERROR:"+e.error,createTwitterLink()}function createTwitterLink(){const e=document.querySelector(".share__finish--anchor"),t=encodeURIComponent("¡Aquí está mi nueva tarjeta!"),r=document.querySelector(".js-card-link2").href;console.log(r),e.href=`https://twitter.com/intent/tweet?text=${t}&url=${r}`}btn.addEventListener("click",finishClick);